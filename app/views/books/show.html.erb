<div class="container px-5 px-sm-0">
  <div class="row">

    <%= render "layouts/sidebar", user: @user, book: @book_new %>

    <!-- ===== å³ï¼šBook detail ===== -->
    <div class="col-md-8 offset-md-1">
      <h2>Book detail</h2>

      <table class="table">
        <tbody>
          <tr>
          <!-- ç”»åƒ + æŠ•ç¨¿è€…åï¼ˆå·¦ç«¯ï¼‰ -->
            <td class="align-middle" style="width: 120px;">
              <%= link_to user_path(@user) do %>
                <% if @user.profile_image&.attached? %>
                  <%= image_tag @user.profile_image, style: "width:100px;height:100px;object-fit:cover;" %>
                <% else %>
                  <%= image_tag "no_image.jpg", style: "width:100px;height:100px;" %>
                <% end %>
              <% end %>

              <div class="mt-2">
                <%= link_to @user.name, user_path(@user) %>
              </div>
            </td>

            <!-- Title -->
            <td class="align-middle">
              <%= @book.title %>
            </td>

            <!-- Opinion -->
            <td class="align-middle">
              <%= @book.body %>
            </td>

            <!-- ã„ã„ã­ -->
            <td class="align-middle text-center">
              <% if @book.favorited_by?(current_user) %>
                <%= link_to "â¤ï¸#{@book.favorites.count}",
                            book_favorite_path(@book),
                            data: { turbo_method: :delete },
                            class: "text-danger text-decoration-none fs-5" %>
              <% else %>
                <%= link_to "ðŸ’™#{@book.favorites.count}",
                            book_favorite_path(@book),
                            data: { turbo_method: :post },
                            class: "text-muted text-decoration-none fs-5" %>
              <% end %>
            </td>

            <!-- ã‚³ãƒ¡ãƒ³ãƒˆæ•° -->
            <td class="align-middle text-center">
              ã‚³ãƒ¡ãƒ³ãƒˆæ•°: <%= @book.book_comments.count %>
            </td>

            <!-- Editï¼ˆæœ¬äººã ã‘ï¼‰ -->
            <td class="align-middle">
              <% if @book.user_id == current_user.id %>
                <%= link_to "Edit", edit_book_path(@book), class: "btn btn-success btn-sm" %>
              <% end %>
            </td>

            <!-- Destroyï¼ˆæœ¬äººã ã‘ï¼‰ -->
            <td class="align-middle">
              <% if @book.user_id == current_user.id %>
                <%= link_to "Destroy",
                            book_path(@book),
                            data: { turbo_method: :delete, turbo_confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" },
                            class: "btn btn-danger btn-sm" %>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>

      <% @book_comments.each do |comment| %>
      <div class="d-flex justify-content-between align-items-start border-bottom py-3">

      <div class="d-flex gap-3">
       <div class="text-center" style="width: 110px;">
          <%= link_to user_path(comment.user) do %>
           <% if comment.user.profile_image&.attached? %>
            <%= image_tag comment.user.profile_image,
                          class: "rounded-circle",
                          style: "width:80px;height:80px;object-fit:cover;" %>
            <% else %>
              <%= image_tag "no_image.jpg",
                          class: "rounded-circle",
                          style: "width:80px;height:80px;object-fit:cover;" %>
            <% end %>
         <% end %>

        <div class="mt-2 small fw-bold">
          <%= link_to comment.user.name, user_path(comment.user), class: "text-decoration-none" %>
        </div>
      </div>

      <div>
        <div>
          <%= simple_format(h(comment.comment)) %>
        </div>
      </div>
    </div>

    <div>
      <% if comment.user == current_user %>
        <%= link_to "å‰Šé™¤",
                    book_book_comment_path(@book, comment),
                    class: "btn btn-sm btn-outline-danger",
                    data: { turbo_method: :delete, turbo_confirm: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" } %>
      <% end %>
    </div>
  </div>
<% end %>

<div class="mt-4">
  <%= form_with model: [@book, @book_comment], local: true do |f| %>
    <div class="mb-2">
      <%= f.text_area :comment, rows: 3, placeholder: "ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã", class: "form-control" %>
    </div>
    <%= f.submit "é€ä¿¡", class: "btn btn-primary" %>
  <% end %>
</div>


